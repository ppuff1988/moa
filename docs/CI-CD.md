# CI/CD è¨­å®šæŒ‡å—

æœ¬å°ˆæ¡ˆä½¿ç”¨ GitHub Actions å¯¦ç¾è‡ªå‹•åŒ– CI/CD æµç¨‹ã€‚

## ğŸ“‹ ç›®éŒ„

- [CI æµç¨‹](#ci-æµç¨‹)
- [CD æµç¨‹](#cd-æµç¨‹)
- [ç’°å¢ƒè®Šæ•¸è¨­å®š](#ç’°å¢ƒè®Šæ•¸è¨­å®š)
- [éƒ¨ç½²æ­¥é©Ÿ](#éƒ¨ç½²æ­¥é©Ÿ)
- [æ‰‹å‹•è§¸ç™¼éƒ¨ç½²](#æ‰‹å‹•è§¸ç™¼éƒ¨ç½²)
- [å®‰å…¨æœ€ä½³å¯¦è¸](#å®‰å…¨æœ€ä½³å¯¦è¸)

## ğŸ”„ CI æµç¨‹

ç•¶ä»£ç¢¼æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯ï¼Œæˆ–å»ºç«‹ Pull Request æ™‚ï¼Œæœƒè‡ªå‹•åŸ·è¡Œä»¥ä¸‹æª¢æŸ¥ï¼š

### 1. ç¨‹å¼ç¢¼æª¢æŸ¥ (Lint)

- ESLint ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- Prettier ç¨‹å¼ç¢¼æ ¼å¼æª¢æŸ¥
- TypeScript é¡å‹æª¢æŸ¥

### 2. å–®å…ƒæ¸¬è©¦

- åŸ·è¡Œ Vitest å–®å…ƒæ¸¬è©¦
- ç¢ºä¿æ‰€æœ‰å–®å…ƒæ¸¬è©¦é€šé

### 3. API æ¸¬è©¦

- ä½¿ç”¨ PostgreSQL æœå‹™
- åŸ·è¡Œæ‰€æœ‰ API ç«¯é»æ¸¬è©¦
- é©—è­‰å¾Œç«¯åŠŸèƒ½

### 4. E2E æ¸¬è©¦

- ä½¿ç”¨ Playwright åŸ·è¡Œç«¯åˆ°ç«¯æ¸¬è©¦
- æ¸¬è©¦å®Œæ•´çš„ä½¿ç”¨è€…æµç¨‹
- ç”Ÿæˆæ¸¬è©¦å ±å‘Šä¸¦ä¿å­˜ 30 å¤©

### 5. å»ºç½®æª¢æŸ¥

- ç¢ºä¿æ‡‰ç”¨ç¨‹å¼å¯ä»¥æˆåŠŸå»ºç½®
- é©—è­‰ Docker æ˜ åƒå¯ä»¥æ­£ç¢ºå»ºç½®

## ğŸš€ CD æµç¨‹

ç•¶ä»£ç¢¼æ¨é€åˆ° `main` åˆ†æ”¯æ™‚ï¼Œæœƒè‡ªå‹•åŸ·è¡Œéƒ¨ç½²æµç¨‹ï¼š

### éƒ¨ç½²æ­¥é©Ÿ

1. **å»ºç½® Docker æ˜ åƒ**
   - å»ºç«‹å¤šæ¶æ§‹æ”¯æ´çš„æ˜ åƒ
   - æ¨é€åˆ° Docker Hub
   - æ¨™è¨˜ç‚º `latest` å’Œ commit SHA

2. **éƒ¨ç½²åˆ°ä¼ºæœå™¨**
   - é€é SSH é€£æ¥åˆ°éƒ¨ç½²ä¼ºæœå™¨
   - æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
   - æ›´æ–° Docker å®¹å™¨
   - è‡ªå‹•åŸ·è¡Œè³‡æ–™åº«é·ç§»

3. **å¥åº·æª¢æŸ¥**
   - ç­‰å¾…æœå‹™å•Ÿå‹•
   - æª¢æŸ¥ `/api/health` ç«¯é»
   - ç¢ºä¿æœå‹™æ­£å¸¸é‹è¡Œ

4. **é€šçŸ¥**
   - ç™¼é€éƒ¨ç½²çµæœåˆ° Slackï¼ˆå¯é¸ï¼‰

## ğŸ” ç’°å¢ƒè®Šæ•¸è¨­å®š

### GitHub Secrets è¨­å®š

åœ¨ GitHub å°ˆæ¡ˆä¸­éœ€è¦è¨­å®šå…©ç¨®é¡å‹çš„é…ç½®ï¼š

> **ğŸ’¡ é‡è¦æ¦‚å¿µ**ï¼š
>
> - **Variablesï¼ˆè®Šæ•¸ï¼‰**ï¼šå…¬é–‹è³‡è¨Šï¼Œå¯åœ¨æ—¥èªŒä¸­é¡¯ç¤º
> - **Secretsï¼ˆå¯†é‘°ï¼‰**ï¼šæ•æ„Ÿè³‡è¨Šï¼Œåœ¨æ—¥èªŒä¸­æœƒè¢«é®è”½ç‚º `***`
> - æœ¬å°ˆæ¡ˆä½¿ç”¨é è¨­å€¼æ©Ÿåˆ¶ï¼šå³ä½¿ä¸è¨­å®š Secretsï¼ŒCI ä¹Ÿèƒ½é‹è¡Œï¼ˆä½†ä¸å®‰å…¨ï¼‰

---

#### ğŸ“¦ Repository ç´šåˆ¥é…ç½®

é€™äº›é…ç½®é©ç”¨æ–¼æ‰€æœ‰ workflow å’Œç’°å¢ƒã€‚

##### Variablesï¼ˆå…¬é–‹è®Šæ•¸ï¼‰

**è¨­å®šä½ç½®**ï¼šSettings > Secrets and variables > Actions > Variables

é€™äº›æ˜¯ä¸æ•æ„Ÿçš„è³‡è¨Šï¼Œå¯ä»¥åœ¨æ—¥èªŒä¸­é¡¯ç¤ºï¼š

```
DOCKER_USERNAME       # Docker Hub ä½¿ç”¨è€…åç¨±ï¼ˆå…¬é–‹è³‡è¨Šï¼‰
```

**è¨­å®šæ­¥é©Ÿ**ï¼š

1. å‰å¾€ GitHub å°ˆæ¡ˆé é¢
2. é»æ“Š **Settings** > **Secrets and variables** > **Actions**
3. åˆ‡æ›åˆ° **Variables** é ç±¤
4. é»æ“Š **New repository variable**
5. è¼¸å…¥åç¨±å’Œå€¼ï¼Œé»æ“Š **Add variable**

##### Secretsï¼ˆå¯†é‘°ï¼‰

**è¨­å®šä½ç½®**ï¼šSettings > Secrets and variables > Actions > Secrets

é€™äº›æ˜¯æ•æ„Ÿè³‡è¨Šï¼Œæœƒåœ¨æ—¥èªŒä¸­è¢«é®è”½ï¼š

**Docker Hub æ†‘è­‰ï¼ˆç”¨æ–¼ CD éƒ¨ç½²ï¼‰**

```
DOCKER_PASSWORD       # Docker Hub å¯†ç¢¼æˆ–å­˜å–ä»¤ç‰Œï¼ˆå»ºè­°ä½¿ç”¨ Access Tokenï¼‰
```

**æ¸¬è©¦ç’°å¢ƒè³‡æ–™åº«æ†‘è­‰ï¼ˆç”¨æ–¼ CI æ¸¬è©¦ï¼‰**

```
TEST_DB_USER          # æ¸¬è©¦è³‡æ–™åº«ä½¿ç”¨è€…åç¨±ï¼ˆé è¨­ï¼šmoa_test_userï¼‰
TEST_DB_PASSWORD      # æ¸¬è©¦è³‡æ–™åº«å¯†ç¢¼ï¼ˆé è¨­ï¼šmoa_test_passï¼Œå»ºè­°è‡ªè¨‚å¼·å¯†ç¢¼ï¼‰
TEST_DB_NAME          # æ¸¬è©¦è³‡æ–™åº«åç¨±ï¼ˆé è¨­ï¼šmoa_test_dbï¼‰
```

> **âš ï¸ é—œæ–¼æ¸¬è©¦è³‡æ–™åº« Secrets**ï¼š
>
> é€™äº› Secrets ä½¿ç”¨äº†**é è¨­å€¼æ©Ÿåˆ¶**ï¼ˆfallbackï¼‰ï¼š
>
> - âœ… å¦‚æœè¨­å®šäº† Secretï¼ŒCI æœƒä½¿ç”¨ä½ è¨­å®šçš„å€¼
> - âš ï¸ å¦‚æœæœªè¨­å®šï¼ŒCI æœƒä½¿ç”¨é è¨­å€¼ï¼ˆ`moa_test_user` / `moa_test_pass` / `moa_test_db`ï¼‰
> - ğŸ”’ **å¼·çƒˆå»ºè­°è¨­å®šè‡ªè¨‚çš„å¼·å¯†ç¢¼**ï¼Œé¿å…ä½¿ç”¨é è¨­å€¼
>
> é è¨­å€¼æ©Ÿåˆ¶çš„å¥½è™•ï¼š
>
> - å‘å¾Œå…¼å®¹ï¼šå³ä½¿æœªè¨­å®š Secretsï¼ŒCI ä¹Ÿèƒ½æ­£å¸¸é‹è¡Œ
> - å½ˆæ€§é…ç½®ï¼šå¯æ ¹æ“šéœ€è¦è‡ªè¨‚æ¸¬è©¦ç’°å¢ƒé…ç½®
> - é–‹ç™¼å‹å–„ï¼šæ–°åŠ å…¥çš„é–‹ç™¼è€…ä¸æœƒå› ç‚ºç¼ºå°‘ Secrets è€Œç„¡æ³•è·‘ CI

**è¨­å®šæ­¥é©Ÿ**ï¼š

1. å‰å¾€ GitHub å°ˆæ¡ˆé é¢
2. é»æ“Š **Settings** > **Secrets and variables** > **Actions**
3. ç¢ºä¿åœ¨ **Secrets** é ç±¤ï¼ˆé è¨­ï¼‰
4. é»æ“Š **New repository secret**
5. è¼¸å…¥åç¨±å’Œå€¼ï¼Œé»æ“Š **Add secret**
6. ä¾åºæ–°å¢æ‰€æœ‰éœ€è¦çš„ Secrets

---

#### ğŸ¤” å¦‚ä½•é¸æ“‡ Variables vs Secretsï¼Ÿ

åœ¨è¨­å®š GitHub Actions é…ç½®å‰ï¼Œè«‹åƒè€ƒä»¥ä¸‹æ±ºç­–æŒ‡å—ï¼š

##### ğŸ“Š æ±ºç­–æµç¨‹åœ–

```
é€™å€‹è³‡è¨Šæ˜¯å¦æ•æ„Ÿï¼Ÿ
    â”œâ”€ æ˜¯ï¼ˆå¯†ç¢¼ã€Tokenã€ç§é‘°ç­‰ï¼‰
    â”‚   â””â”€ ä½¿ç”¨ Secret âœ…
    â”‚
    â””â”€ å¦ï¼ˆä¸»æ©Ÿåç¨±ã€ä½¿ç”¨è€…åç¨±ã€è·¯å¾‘ç­‰ï¼‰
        â””â”€ ä½¿ç”¨ Variable âœ…

é€™å€‹é…ç½®æ˜¯å¦æ‰€æœ‰ç’°å¢ƒéƒ½ç›¸åŒï¼Ÿ
    â”œâ”€ æ˜¯ï¼ˆDocker Hub å¸³è™Ÿã€æ¸¬è©¦è³‡æ–™åº«ç­‰ï¼‰
    â”‚   â””â”€ ä½¿ç”¨ Repository ç´šåˆ¥ âœ…
    â”‚
    â””â”€ å¦ï¼ˆç”Ÿç”¢/æ¸¬è©¦ç’°å¢ƒçš„ä¸»æ©Ÿã€è³‡æ–™åº«ç­‰ï¼‰
        â””â”€ ä½¿ç”¨ Environment ç´šåˆ¥ âœ…
```

##### ğŸ” å¯¦éš›ç¯„ä¾‹å°ç…§è¡¨

| è³‡è¨Šé¡å‹              | ç¯„ä¾‹å€¼                     | é¡å‹     | ç´šåˆ¥        | åŸå›                        |
| --------------------- | -------------------------- | -------- | ----------- | -------------------------- |
| Docker Hub ä½¿ç”¨è€…åç¨± | `myusername`               | Variable | Repository  | å…¬é–‹è³‡è¨Šï¼Œæ‰€æœ‰ç’°å¢ƒç›¸åŒ     |
| Docker Hub å¯†ç¢¼/Token | `ghp_xxxxx`                | Secret   | Repository  | æ•æ„Ÿè³‡è¨Šï¼Œæ‰€æœ‰ç’°å¢ƒç›¸åŒ     |
| æ¸¬è©¦è³‡æ–™åº«å¯†ç¢¼        | `test_pass_123`            | Secret   | Repository  | æ•æ„Ÿè³‡è¨Šï¼Œåƒ…æ¸¬è©¦ç”¨         |
| ç”Ÿç”¢ä¼ºæœå™¨ IP         | `54.123.45.67`             | Variable | Environment | å…¬é–‹è³‡è¨Šï¼Œä½†ä¸åŒç’°å¢ƒä¸åŒ   |
| ç”Ÿç”¢ä¼ºæœå™¨ SSH ç§é‘°   | `-----BEGIN...`            | Secret   | Environment | æ•æ„Ÿè³‡è¨Šï¼Œä¸åŒç’°å¢ƒä¸åŒ     |
| éƒ¨ç½²è·¯å¾‘              | `/home/ubuntu/moa`         | Variable | Environment | å…¬é–‹è³‡è¨Šï¼Œä¸åŒç’°å¢ƒå¯èƒ½ä¸åŒ |
| ç”Ÿç”¢è³‡æ–™åº«é€£ç·šå­—ä¸²    | `postgres://user:pass@...` | Secret   | Environment | åŒ…å«å¯†ç¢¼ï¼Œä¸åŒç’°å¢ƒä¸åŒ     |
| JWT å¯†é‘°              | `random_secret_key`        | Secret   | Environment | æ•æ„Ÿè³‡è¨Šï¼Œä¸åŒç’°å¢ƒæ‡‰ä¸åŒ   |

##### ğŸ’¡ åˆ¤æ–·åŸå‰‡

**ä½¿ç”¨ Variableï¼ˆè®Šæ•¸ï¼‰çš„æ™‚æ©Ÿï¼š**

- âœ… å¯ä»¥å…¬é–‹é¡¯ç¤ºåœ¨æ—¥èªŒä¸­
- âœ… ä¸æ˜¯å¯†ç¢¼ã€Tokenã€ç§é‘°ç­‰æ•æ„Ÿè³‡è¨Š
- âœ… ä¾‹å¦‚ï¼šä¸»æ©Ÿåç¨±ã€ä½¿ç”¨è€…åç¨±ã€åŸ è™Ÿã€è·¯å¾‘ã€ç¶²å€

**ä½¿ç”¨ Secretï¼ˆå¯†é‘°ï¼‰çš„æ™‚æ©Ÿï¼š**

- ğŸ”’ çµ•å°ä¸èƒ½å‡ºç¾åœ¨æ—¥èªŒä¸­
- ğŸ”’ åŒ…å«æ•æ„Ÿè³‡è¨Š
- ğŸ”’ ä¾‹å¦‚ï¼šå¯†ç¢¼ã€API Tokenã€SSH ç§é‘°ã€è³‡æ–™åº«é€£ç·šå­—ä¸²ï¼ˆå«å¯†ç¢¼ï¼‰ã€JWT å¯†é‘°

**ä½¿ç”¨ Repository ç´šåˆ¥çš„æ™‚æ©Ÿï¼š**

- ğŸŒ æ‰€æœ‰ç’°å¢ƒéƒ½ä½¿ç”¨ç›¸åŒçš„å€¼
- ğŸŒ é€šç”¨é…ç½®ï¼Œä¸åˆ†ç’°å¢ƒ
- ğŸŒ ä¾‹å¦‚ï¼šDocker Hub æ†‘è­‰ã€æ¸¬è©¦è³‡æ–™åº«é…ç½®ã€å…±ç”¨çš„ç¬¬ä¸‰æ–¹ API Key

**ä½¿ç”¨ Environment ç´šåˆ¥çš„æ™‚æ©Ÿï¼š**

- ğŸ¯ ä¸åŒç’°å¢ƒéœ€è¦ä¸åŒçš„å€¼
- ğŸ¯ éœ€è¦ç’°å¢ƒéš”é›¢å’Œä¿è­·è¦å‰‡
- ğŸ¯ ä¾‹å¦‚ï¼šç”Ÿç”¢/æ¸¬è©¦ä¼ºæœå™¨é…ç½®ã€ä¸åŒç’°å¢ƒçš„è³‡æ–™åº«ã€ä¸åŒçš„ JWT å¯†é‘°

##### âš ï¸ å¸¸è¦‹éŒ¯èª¤ç¤ºç¯„

âŒ **éŒ¯èª¤ 1**ï¼šæŠŠ SSH ç§é‘°æ”¾åœ¨ Variable ä¸­

```yaml
# âŒ éŒ¯èª¤ï¼ç§é‘°æœƒé¡¯ç¤ºåœ¨æ—¥èªŒä¸­
- run: echo "${{ vars.DEPLOY_SSH_KEY }}"
```

âœ… **æ­£ç¢º**ï¼šæ‡‰è©²æ”¾åœ¨ Secret ä¸­

```yaml
# âœ… æ­£ç¢ºï¼Secret æœƒè¢«é®è”½
- run: echo "${{ secrets.DEPLOY_SSH_KEY }}" > key.pem
```

âŒ **éŒ¯èª¤ 2**ï¼šæŠŠç”Ÿç”¢è³‡æ–™åº« URL æ”¾åœ¨ Repository Secret

```yaml
# âŒ éŒ¯èª¤ï¼æ‰€æœ‰ç’°å¢ƒéƒ½æœƒç”¨åˆ°åŒä¸€å€‹è³‡æ–™åº«
environment: production
env:
  DATABASE_URL: ${{ secrets.DATABASE_URL }} # Repository ç´šåˆ¥
```

âœ… **æ­£ç¢º**ï¼šæ‡‰è©²æ”¾åœ¨ Environment Secret

```yaml
# âœ… æ­£ç¢ºï¼ä¸åŒç’°å¢ƒä½¿ç”¨ä¸åŒçš„è³‡æ–™åº«
environment: production # ä½¿ç”¨ production ç’°å¢ƒçš„ DATABASE_URL
env:
  DATABASE_URL: ${{ secrets.DATABASE_URL }} # Environment ç´šåˆ¥
```

âŒ **éŒ¯èª¤ 3**ï¼šæŠŠå…¬é–‹çš„ä¸»æ©Ÿ IP æ”¾åœ¨ Secret

```yaml
# âŒ ä¸å¿…è¦ï¼ä¸»æ©Ÿ IP ä¸æ˜¯æ•æ„Ÿè³‡è¨Š
DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
```

âœ… **æ­£ç¢º**ï¼šæ‡‰è©²æ”¾åœ¨ Variable

```yaml
# âœ… æ­£ç¢ºï¼ä¸»æ©Ÿ IP å¯ä»¥å…¬é–‹
DEPLOY_HOST: ${{ vars.DEPLOY_HOST }}
```

##### ğŸ“ åœ¨ Workflow ä¸­ä½¿ç”¨çš„èªæ³•

**å¼•ç”¨ Repository Variable**ï¼š

```yaml
${{ vars.VARIABLE_NAME }}
# ä¾‹å¦‚ï¼š${{ vars.DOCKER_USERNAME }}
```

**å¼•ç”¨ Repository Secret**ï¼š

```yaml
${{ secrets.SECRET_NAME }}
# ä¾‹å¦‚ï¼š${{ secrets.DOCKER_PASSWORD }}
```

**å¼•ç”¨ Environment Variable/Secret**ï¼š

```yaml
jobs:
  deploy:
    environment: production # æŒ‡å®šç’°å¢ƒ
    steps:
      - run: echo "${{ vars.DEPLOY_HOST }}" # Environment Variable
      - run: echo "${{ secrets.DEPLOY_SSH_KEY }}" # Environment Secret
```

> **ğŸ’¡ é‡é»**ï¼šEnvironment ç´šåˆ¥çš„é…ç½®å„ªå…ˆæ¬Šæ›´é«˜ã€‚å¦‚æœåŒæ™‚å­˜åœ¨ Repository å’Œ Environment ç´šåˆ¥çš„åŒåé…ç½®ï¼Œæœƒä½¿ç”¨ Environment ç´šåˆ¥çš„å€¼ã€‚

---

#### ğŸŒ Environment Secretsï¼ˆç’°å¢ƒç´šåˆ¥ï¼‰

**è¨­å®šä½ç½®**ï¼šSettings > Environments

ç’°å¢ƒç´šåˆ¥çš„å¯†é‘°è®“ä½ å¯ä»¥ç‚ºä¸åŒç’°å¢ƒï¼ˆç”Ÿç”¢ã€æ¸¬è©¦ï¼‰è¨­å®šä¸åŒçš„å€¼ï¼Œæä¾›æ›´å¥½çš„éš”é›¢æ€§å’Œå®‰å…¨æ€§ã€‚

##### æ­¥é©Ÿ 1ï¼šå‰µå»ºç’°å¢ƒ

1. å‰å¾€ **Settings** > **Environments**
2. é»æ“Š **New environment**
3. å‰µå»ºä»¥ä¸‹ç’°å¢ƒï¼š
   - `production` - ç”Ÿç”¢ç’°å¢ƒ
   - `staging` - æ¸¬è©¦ç’°å¢ƒï¼ˆå¯é¸ï¼‰

##### æ­¥é©Ÿ 2ï¼šè¨­å®šç’°å¢ƒä¿è­·è¦å‰‡ï¼ˆæ¨è–¦ï¼‰

åœ¨ **production** ç’°å¢ƒä¸­ï¼š

1. å‹¾é¸ **Required reviewers**ï¼ˆéœ€è¦å¯©æ‰¹æ‰èƒ½éƒ¨ç½²ï¼‰
2. æ·»åŠ å¯ä»¥æ‰¹å‡†éƒ¨ç½²çš„äººå“¡
3. å‹¾é¸ **Wait timer**ï¼ˆå¯é¸ï¼Œç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œæ‰éƒ¨ç½²ï¼‰

##### æ­¥é©Ÿ 3ï¼šç‚ºæ¯å€‹ç’°å¢ƒæ·»åŠ é…ç½®

åœ¨æ¯å€‹ç’°å¢ƒä¸­ï¼Œå¯ä»¥è¨­å®š **Variables**ï¼ˆè®Šæ•¸ï¼‰å’Œ **Secrets**ï¼ˆå¯†é‘°ï¼‰ï¼š

**Environment Variablesï¼ˆç’°å¢ƒè®Šæ•¸ - å…¬é–‹è³‡è¨Šï¼‰**

```
DEPLOY_HOST          # ä¼ºæœå™¨ IP æˆ–ç¶²åŸŸ
                     # ç¯„ä¾‹ï¼š
                     # - production: 54.123.45.67
                     # - staging: 54.123.45.68

DEPLOY_USER          # SSH ä½¿ç”¨è€…åç¨±
                     # ç¯„ä¾‹ï¼šubuntu æˆ– ec2-user

DEPLOY_PORT          # SSH åŸ è™Ÿï¼ˆé è¨­ 22ï¼‰

DEPLOY_PATH          # å°ˆæ¡ˆéƒ¨ç½²è·¯å¾‘
                     # ç¯„ä¾‹ï¼š/home/ubuntu/moa

DEPLOY_URL           # æ‡‰ç”¨ç¨‹å¼ç¶²å€
                     # ç¯„ä¾‹ï¼š
                     # - production: https://moa.example.com
                     # - staging: https://staging.moa.example.com

POSTGRES_USER        # PostgreSQL ä½¿ç”¨è€…åç¨±
POSTGRES_DB          # PostgreSQL è³‡æ–™åº«åç¨±
```

**Environment Secretsï¼ˆç’°å¢ƒå¯†é‘° - æ•æ„Ÿè³‡è¨Šï¼‰**

```
DEPLOY_SSH_KEY       # SSH ç§é‘°ï¼ˆå®Œæ•´å…§å®¹ï¼ŒåŒ…å« BEGIN å’Œ ENDï¼‰
                     # ç¯„ä¾‹ï¼š
                     # -----BEGIN OPENSSH PRIVATE KEY-----
                     # ...ç§é‘°å…§å®¹...
                     # -----END OPENSSH PRIVATE KEY-----

DATABASE_URL         # è³‡æ–™åº«é€£ç·šå­—ä¸²ï¼ˆåŒ…å«å¯†ç¢¼ï¼‰
                     # ç¯„ä¾‹ï¼špostgres://user:pass@db:5432/dbname
                     # âš ï¸ ç”Ÿç”¢å’Œæ¸¬è©¦ç’°å¢ƒæ‡‰ä½¿ç”¨ä¸åŒçš„è³‡æ–™åº«
                     # ğŸ’¡ æ³¨æ„ï¼šä½¿ç”¨ @db:5432ï¼ˆå®¹å™¨åç¨±ï¼‰è€Œé @localhost:5432
                     #    å› ç‚ºåœ¨ Docker Compose ä¸­ï¼Œå®¹å™¨é–“é€éæœå‹™åç¨±é€šè¨Š

JWT_SECRET           # JWT å¯†é‘°ï¼ˆè‡³å°‘ 32 å­—å…ƒçš„éš¨æ©Ÿå­—ä¸²ï¼‰
                     # ç”Ÿæˆæ–¹å¼ï¼šopenssl rand -base64 48

POSTGRES_PASSWORD    # PostgreSQL å¯†ç¢¼ï¼ˆå»ºè­°ä½¿ç”¨å¼·å¯†ç¢¼ï¼‰
```

**é€šçŸ¥é…ç½®ï¼ˆå¯é¸ - Secretsï¼‰**

```
TELEGRAM_BOT_TOKEN   # Telegram Bot Tokenï¼ˆç”¨æ–¼éƒ¨ç½²é€šçŸ¥ï¼‰
                     # ç¯„ä¾‹ï¼š123456789:ABCdefGHIjklMNOpqrsTUVwxyz
                     # å–å¾—æ–¹å¼ï¼šå‘ @BotFather ç”³è«‹

TELEGRAM_CHAT_ID     # Telegram Chat ID æˆ– Channel ID
                     # ç¯„ä¾‹ï¼š-1001234567890ï¼ˆç¾¤çµ„ï¼‰æˆ– 123456789ï¼ˆå€‹äººï¼‰
                     # å–å¾—æ–¹å¼ï¼šä½¿ç”¨ @userinfobot æˆ– @getmyid_bot
```

> **ğŸ’¡ å€åˆ†åŸå‰‡**ï¼š
>
> - **Variableï¼ˆè®Šæ•¸ï¼‰**ï¼šä½¿ç”¨è€…åç¨±ã€ä¸»æ©Ÿä½å€ã€åŸ è™Ÿã€è·¯å¾‘ç­‰å…¬é–‹è³‡è¨Š
> - **Secretï¼ˆå¯†é‘°ï¼‰**ï¼šå¯†ç¢¼ã€Tokenã€ç§é‘°ã€åŒ…å«å¯†ç¢¼çš„é€£ç·šå­—ä¸²ç­‰æ•æ„Ÿè³‡è¨Š

---

#### ğŸ”‘ å¦‚ä½•ç”Ÿæˆå®‰å…¨çš„å¯†é‘°

**ç”Ÿæˆ JWT Secret**ï¼š

```bash
# ç”Ÿæˆ 48 å­—å…ƒçš„éš¨æ©Ÿå¯†é‘°
openssl rand -base64 48
```

**ç”Ÿæˆè³‡æ–™åº«å¯†ç¢¼**ï¼š

```bash
# ç”Ÿæˆ 24 å­—å…ƒçš„éš¨æ©Ÿå¯†ç¢¼
openssl rand -base64 24
```

**ç²å– SSH ç§é‘°**ï¼š

```bash
# æŸ¥çœ‹ä½ çš„ SSH ç§é‘°ï¼ˆé€šå¸¸åœ¨é€™äº›ä½ç½®ï¼‰
cat ~/.ssh/id_rsa
cat ~/.ssh/id_ed25519

# æˆ–è€…ç”Ÿæˆæ–°çš„ SSH é‡‘é‘°å°
ssh-keygen -t ed25519 -C "deploy-key-moa"
```

**ç²å– Docker Hub Access Token**ï¼ˆæ¨è–¦ï¼Œæ¯”å¯†ç¢¼æ›´å®‰å…¨ï¼‰ï¼š

1. ç™»å…¥ [Docker Hub](https://hub.docker.com/)
2. å‰å¾€ **Account Settings** > **Security** > **Access Tokens**
3. é»æ“Š **New Access Token**
4. è¨­å®šæ¬Šé™ç‚º **Read, Write, Delete**
5. è¤‡è£½ç”Ÿæˆçš„ token

**è¨­å®š Telegram Botï¼ˆç”¨æ–¼éƒ¨ç½²é€šçŸ¥ï¼‰**ï¼š

1. **å»ºç«‹ Telegram Bot**ï¼š
   - åœ¨ Telegram ä¸­æœå°‹ `@BotFather`
   - ç™¼é€ `/newbot` æŒ‡ä»¤
   - ä¾ç…§æŒ‡ç¤ºè¨­å®š Bot åç¨±å’Œä½¿ç”¨è€…åç¨±
   - è¤‡è£½å¾—åˆ°çš„ **Bot Token**ï¼ˆæ ¼å¼ï¼š`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`ï¼‰

2. **å–å¾— Chat ID**ï¼š

   **æ–¹æ³• 1ï¼šä½¿ç”¨ Bot å–å¾—å€‹äºº Chat ID**
   - æœå°‹ `@userinfobot` æˆ– `@getmyid_bot`
   - é–‹å•Ÿå°è©±å³å¯çœ‹åˆ°ä½ çš„ Chat ID

   **æ–¹æ³• 2ï¼šå–å¾—ç¾¤çµ„ Chat ID**
   - å°‡ä½ çš„ Bot åŠ å…¥ç¾¤çµ„
   - åœ¨ç¾¤çµ„ä¸­ç™¼é€ä»»æ„è¨Šæ¯
   - åœ¨ç€è¦½å™¨è¨ªå•ï¼š`https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
   - åœ¨è¿”å›çš„ JSON ä¸­æ‰¾åˆ° `"chat":{"id":-1001234567890}` çš„å€¼

   **æ–¹æ³• 3ï¼šä½¿ç”¨ curl æŒ‡ä»¤**

   ```bash
   # å°‡ä½ çš„ Bot åŠ å…¥ç¾¤çµ„å¾Œï¼Œåœ¨ç¾¤çµ„ç™¼é€è¨Šæ¯ï¼Œç„¶å¾ŒåŸ·è¡Œï¼š
   curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```

3. **æ¸¬è©¦é€šçŸ¥**ï¼š
   ```bash
   # æ¸¬è©¦ç™¼é€è¨Šæ¯
   curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage" \
     -d "chat_id=<YOUR_CHAT_ID>" \
     -d "text=Test message from MOA"
   ```

> **ğŸ’¡ æç¤º**ï¼š
>
> - Chat ID å¯ä»¥æ˜¯å€‹äººï¼ˆæ­£æ•´æ•¸ï¼‰æˆ–ç¾¤çµ„/é »é“ï¼ˆè² æ•´æ•¸ï¼‰
> - è¨˜å¾—çµ¦ Bot åœ¨ç¾¤çµ„ä¸­çš„ç™¼è¨€æ¬Šé™
> - å»ºè­°å»ºç«‹ä¸€å€‹å°ˆé–€çš„éƒ¨ç½²é€šçŸ¥é »é“æˆ–ç¾¤çµ„

```

```
